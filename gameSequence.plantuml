@startuml GameSequence

actor Player as C
participant "ClientApp\n(NetworkClient)" as Client
participant "Server\n(LobbyManager)" as Server
participant "Room\n(GameInstance)" as Room
participant "Registry+Systems" as ECS

== Connexion ==
C -> Client : connect(serverAddr)
Client -> Server : NEW_CLIENT
Server -> Client : ACCEPT_CLIENT(clientId)

== Lobby ==
C -> Client : mark ready
Client -> Server : PLAYER_READY
Server -> Room : addPlayer(clientId)

== Lancement ==
Server -> Client : GAME_START
Client -> Client : init local Registry

== Boucle de jeu ==
loop chaque tick (60Hz côté serveur)
  C -> Client : input (move/shoot)
  Client -> Server : CLIENT_INPUT
  Server -> Room : applyInput(clientId, Input)
  Room -> ECS : update Systems
  ECS -> ECS : update AI / Physics / Collision
  Room -> Server : snapshot(world state)
  Server -> Client : SERVER_SNAPSHOT
  Client -> ECS : apply snapshot
  Client -> Client : local prediction & render
end

== Evénements ==
Room -> Server : GAME_EVENT(explosion, score, etc.)
Server -> Client : GAME_EVENT
Client -> Client : show animation / sound

== Fin de partie ==
Server -> Client : GAME_OVER (win/lose/draw)
Client -> Client : afficher résultats
@enduml
